(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{312:function(t,e,n){"use strict";n.r(e);var r=n(28),o=(n(70),n(19),n(11),n(104),n(20),n(35),n(1),n(14),n(105),{data:function(){return{loading:!0,loadingOrg:!0,uploadedFiles:[],taskInfo:{},qrInfo:{},listSupplier:[],staffUser:{}}},methods:{showMsgBoxTwo:function(){var t=this;this.boxTwo="",this.$bvModal.msgBoxOk("Xác nhận thành công!",{noCloseOnBackdrop:!0,noCloseOnEsc:!0,title:"Thông báo",size:"sm",buttonSize:"sm",okVariant:"success",headerClass:"p-2 border-bottom-0",footerClass:"p-2 border-top-0",centered:!0}).then((function(e){t.$router.go(-1)})).catch((function(t){}))},formatPrice:function(t){return(t/1).toFixed(0).replace(".",",").toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},displayStatus:function(t){return"CREATED"===t?"Chờ xác nhận":"Đã xác nhận"},fun_xac_nhan:function(){var t=this;console.log("ooooo"),this.openAlert("Xác nhận thành công!",(function(){t.$router.navigate("/dich-vu-da-xac-nhan/")}))},handleFilesUploads:function(t){var e=this.$refs.files.files;this.submitFiles(e)},removeImage:function(t){this.uploadedFiles=this.uploadedFiles.filter((function(e,i){return i!==t}))},submitFiles:function(t){for(var e=this,n=new FormData,i=0;i<t.length;i++){var r=t[i];n.append("files["+i+"]",r)}this.$axios.post("https://media.vinaas.com/upload/cuscode",n,{headers:{"Content-Type":"multipart/form-data","Access-Control-Allow-Origin":"*"}}).then((function(t){e.uploadedFiles.push("https://media.vinaas.com/file/"+t.data.id)})).catch((function(t){console.log("FAILURE!!",t)}))},getQrId:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$route.params.id,e.next=3,t.$axios.$get("/api/QRIDs/"+n);case 3:t.qrInfo=e.sent,console.log("this.qrInfo",t.qrInfo);case 5:case"end":return e.stop()}}),e)})))()},getTaskInfo:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.$route.params.task,e.next=4,t.$axios.$get("/api/QRActivities/"+n);case 4:t.taskInfo=e.sent,t.uploadedFiles=t.taskInfo&&t.taskInfo.imageUrls||[],console.log(" this.taskInfo",t.taskInfo),t.loading=!1,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,10]])})))()},doneTaskConfirmation:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.taskInfo.status="CONFIRMED",e.next=3,t.$axios.$patch("/api/QRActivities/",t.taskInfo);case 3:if(!e.sent){e.next=14;break}return t.showMsgBoxTwo(),e.next=8,t.$axios.$get("/api/Organizations/"+t.taskInfo.supplierOrganizationId+"/users");case 8:if(n=e.sent,!(r=n.filter((function(t){return"BOSS"===t.roleCode||"SALE"===t.roleCode})))){e.next=14;break}return o=r.map((function(t){return t.id})),e.next=14,t.$axios.$get("/api/UserDeviceTokens/sendPushNotificationToListUserId",{params:{title:"QRcare",body:"Khách hàng vừa xác nhận hoàn thành công việc.",listuserid:o}});case 14:case"end":return e.stop()}}),e)})))()},submitQrdelivery:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.$route.params.id,t.qrInfo.status="QRID_STATUS.ACTIVE",t.qrInfo.imageUrls=t.uploadedFiles,t.$axios.$patch("/api/QRIDs/"+n,t.qrInfo).then(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(n){var r,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.taskInfo.status="CONFIRMED",e.next=3,t.$axios.$patch("/api/QRActivities/",t.taskInfo);case 3:if(!e.sent){e.next=14;break}return t.showMsgBoxTwo(),e.next=8,t.$axios.$get("/api/Organizations/"+t.taskInfo.supplierOrganizationId+"/users");case 8:if(r=e.sent,!(o=r.filter((function(t){return"BOSS"===t.roleCode||"SALE"===t.roleCode})))){e.next=14;break}return l=o.map((function(t){return t.id})),e.next=14,t.$axios.$get("/api/UserDeviceTokens/sendPushNotificationToListUserId",{params:{title:"QRcare",body:"Khách hàng vừa xác nhận lắp đặt.",listuserid:l}});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){console.log("error",t)}));case 4:case"end":return e.stop()}}),e)})))()},getStaffInfo:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.$get("api/Organizations/"+t.taskInfo.supplierOrganizationId+"/users/"+t.taskInfo.supplierStaffId);case 2:t.staffUser=e.sent;case 3:case"end":return e.stop()}}),e)})))()},displayStaffName:function(){return this.staffUser&&this.staffUser.fullName},getSupplier:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.$get("/api/Organizations/");case 2:t.listSupplier=e.sent,console.log("this.listSupplier",t.listSupplier),t.loadingOrg=!1;case 5:case"end":return e.stop()}}),e)})))()},displaySupplierName:function(t){var e=this.listSupplier.find((function(e){return e.id===t}));return e&&e.fullname},displaySupplierPhone:function(t){var e=this.listSupplier.find((function(e){return e.id===t}));return e&&e.hotline}},created:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTaskInfo();case 2:return e.next=4,t.getQrId();case 4:return e.next=6,t.getSupplier();case 6:return e.next=8,t.getStaffInfo();case 8:case"end":return e.stop()}}),e)})))()}}),l=n(53),component=Object(l.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"view_main bg-color-gray"},["QRID_STATUS.CREATED"==t.qrInfo.status?n("b-button",{staticClass:"btn_subport box-shadow d-flex align-items-center",staticStyle:{"z-index":"1"},attrs:{pill:"",variant:"primary"},on:{click:function(e){return t.submitQrdelivery()}}},[n("span",{staticClass:"material-icons text-white mr-2"},[t._v("\r\n            verified_user\r\n        ")]),t._v(" "),n("span",{staticClass:"fs-12 font-weight-bold text-white"},[t._v("Xác nhận lắp đặt")])]):t._e(),t._v(" "),"CREATED"==t.taskInfo.status&&"QRID_STATUS.ACTIVE"==t.qrInfo.status?n("b-button",{staticClass:"btn_subport box-shadow d-flex align-items-center",staticStyle:{"z-index":"1"},attrs:{pill:"",variant:"primary"},on:{click:function(e){return t.doneTaskConfirmation()}}},[n("span",{staticClass:"material-icons text-white mr-2"},[t._v("\r\n            verified_user\r\n        ")]),t._v(" "),n("span",{staticClass:"fs-12 font-weight-bold text-white"},[t._v("Xác nhận công việc")])]):t._e(),t._v(" "),n("div",{staticClass:"container mt-3 pb-5"},[n("b-card",{staticClass:"mt-3",attrs:{"no-body":"",header:"Chi tiết dịch vụ","header-class":"fs-14 font-weight-bold px-2 text-uppercase"}},[n("b-skeleton-wrapper",{attrs:{loading:t.loading},scopedSlots:t._u([{key:"loading",fn:function(){return[n("b-list-group",{attrs:{flush:""}},[n("b-list-group-item",{staticClass:"text-black-50 font-weight-bold fs-12 px-2"},[t._v("\r\n                            Dịch vụ thiết bị\r\n                            "),n("b-skeleton",{staticClass:"mt-2",attrs:{width:"50%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Mô tả trình trạng thiết bị\r\n                            "),n("b-skeleton",{staticClass:"mt-2",attrs:{width:"100%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Trạng thái\r\n                            "),n("b-skeleton",{attrs:{width:"40%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Hoàn thành lúc\r\n                            "),n("b-skeleton",{attrs:{width:"50%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Xác nhận bởi\r\n                            "),n("b-skeleton",{attrs:{width:"40%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Phí dịch vụ\r\n                            "),n("b-skeleton",{attrs:{width:"50%"}})],1)],1)]},proxy:!0}])},[t._v(" "),n("b-list-group",{attrs:{flush:""}},[n("b-list-group-item",{staticClass:"text-black-50 font-weight-bold fs-12 px-2"},[t._v("\r\n                        Dịch vụ thiết bị\r\n                        "),n("p",{staticClass:"font-weight-normal mb-0 mt-1 text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.taskInfo.title))])]),t._v(" "),n("b-list-group-item",{staticClass:"font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Mô tả trình trạng thiết bị\r\n                        "),n("p",{staticClass:"font-weight-normal text-dark fs-14 w-100 mt-1 mb-0",attrs:{variant:"0",pill:""}},[t._v(t._s(t.taskInfo.description))])]),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Trạng thái\r\n                        "),n("b-badge",{staticClass:"font-weight-normal text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.displayStatus(t.taskInfo.status)))])],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Hoàn thành lúc\r\n                        "),n("b-badge",{staticClass:"font-weight-normal text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t._f("moment")(t.taskInfo.created,"MM-DD-YYYY h:mm")))])],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Xác nhận bởi\r\n                        "),n("b-badge",{staticClass:"font-weight-normal text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.taskInfo.customerName))])],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Phí dịch vụ\r\n                        "),n("b-badge",{staticClass:"font-weight-normal text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.formatPrice(t.taskInfo.money))+" VNĐ")])],1)],1)],1)],1),t._v(" "),n("b-card",{staticClass:"mt-3",attrs:{"no-body":"",header:"Thông tin cửa hàng","header-class":"fs-14 font-weight-bold px-2 text-uppercase"}},[n("b-skeleton-wrapper",{attrs:{loading:t.loadingOrg},scopedSlots:t._u([{key:"loading",fn:function(){return[n("b-list-group",{attrs:{flush:""}},[n("b-list-group-item",{staticClass:"text-black-50 font-weight-bold fs-12 px-2"},[t._v("\r\n                            Cửa hàng thực hiện\r\n                            "),n("b-skeleton",{staticClass:"mt-2",attrs:{animation:"wave",width:"100%"}}),t._v(" "),n("b-skeleton",{attrs:{animation:"wave",width:"40%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Điện thoại cửa hàng\r\n                            "),n("b-skeleton",{attrs:{width:"40%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                            Nhân viên thực hiện\r\n                            "),n("b-skeleton",{attrs:{width:"60%"}})],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[n("b-skeleton",{staticClass:"text-center",attrs:{width:"100%",type:"button"}})],1)],1)]},proxy:!0}])},[t._v(" "),n("b-list-group",{attrs:{flush:""}},[n("b-list-group-item",{staticClass:"text-black-50 font-weight-bold fs-12 px-2"},[t._v("\r\n                        Cửa hàng thực hiện\r\n                        "),n("p",{staticClass:"font-weight-normal mb-0 mt-1 text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.displaySupplierName(t.taskInfo.supplierOrganizationId)))])]),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Điện thoại cửa hàng\r\n                        "),n("b-badge",{staticClass:"font-weight-normal text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.displaySupplierPhone(t.taskInfo.supplierOrganizationId)))])],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[t._v("\r\n                        Nhân viên thực hiện\r\n                        "),n("b-badge",{staticClass:"font-weight-normal text-dark fs-14",attrs:{variant:"0",pill:""}},[t._v(t._s(t.displayStaffName(t.taskInfo.supplierOrganizationId,t.taskInfo.supplierStaffId)))])],1),t._v(" "),n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center font-weight-bold fs-12 px-2 text-black-50"},[n("NuxtLink",{staticClass:"w-100",attrs:{to:"/cua-hang/"+t.taskInfo.supplierOrganizationId}},[n("b-button",{staticClass:"w-100 fs-12",attrs:{variant:"info"}},[t._v("THÔNG TIN CỬA HÀNG")])],1)],1)],1)],1)],1),t._v(" "),n("b-card",{staticClass:"mt-3",attrs:{"no-body":"",header:"Nhận xét và đánh giá","header-class":"fs-14 font-weight-bold px-2 text-uppercase"}},["CREATED"===t.taskInfo.status?n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center fs-14 px-2 border-0"},[n("b-form-textarea",{staticClass:"fs-14 text-black-50",attrs:{id:"textarea-no-resize",placeholder:"Nhận xét của bạn",rows:"3","no-resize":""},model:{value:t.taskInfo.userComment,callback:function(e){t.$set(t.taskInfo,"userComment",e)},expression:"taskInfo.userComment"}})],1):n("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center  fs-14 px-2 border-0"},[t._v("\r\n                "+t._s(t.taskInfo.userComment)+"\r\n            ")])],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);